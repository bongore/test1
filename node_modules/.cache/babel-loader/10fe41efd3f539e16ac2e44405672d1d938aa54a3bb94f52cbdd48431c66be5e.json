{"ast":null,"code":"import { Eip1559FeesNotSupportedError } from '../../errors/fee.js';\nimport { hexToBigInt } from '../../utils/encoding/fromHex.js';\nimport { getAction } from '../../utils/getAction.js';\nimport { getBlock } from './getBlock.js';\nimport { getGasPrice } from './getGasPrice.js';\n/**\n * Returns an estimate for the max priority fee per gas (in wei) for a\n * transaction to be likely included in the next block.\n * Defaults to [`chain.fees.defaultPriorityFee`](/docs/clients/chains.html#fees-defaultpriorityfee) if set.\n *\n * - Docs: https://viem.sh/docs/actions/public/estimateMaxPriorityFeePerGas.html\n *\n * @param client - Client to use\n * @returns An estimate (in wei) for the max priority fee per gas. {@link EstimateMaxPriorityFeePerGasReturnType}\n *\n * @example\n * import { createPublicClient, http } from 'viem'\n * import { mainnet } from 'viem/chains'\n * import { estimateMaxPriorityFeePerGas } from 'viem/actions'\n *\n * const client = createPublicClient({\n *   chain: mainnet,\n *   transport: http(),\n * })\n * const maxPriorityFeePerGas = await estimateMaxPriorityFeePerGas(client)\n * // 10000000n\n */\nexport async function estimateMaxPriorityFeePerGas(client, args) {\n  return internal_estimateMaxPriorityFeePerGas(client, args);\n}\nexport async function internal_estimateMaxPriorityFeePerGas(client, args) {\n  var _chain$fees, _chain$fees2, _chain$fees3;\n  const {\n    block: block_,\n    chain = client.chain,\n    request\n  } = args || {};\n  if (typeof (chain === null || chain === void 0 || (_chain$fees = chain.fees) === null || _chain$fees === void 0 ? void 0 : _chain$fees.defaultPriorityFee) === 'function') {\n    const block = block_ || (await getAction(client, getBlock, 'getBlock')({}));\n    return chain.fees.defaultPriorityFee({\n      block,\n      client,\n      request\n    });\n  }\n  if (typeof (chain === null || chain === void 0 || (_chain$fees2 = chain.fees) === null || _chain$fees2 === void 0 ? void 0 : _chain$fees2.defaultPriorityFee) !== 'undefined') return chain === null || chain === void 0 || (_chain$fees3 = chain.fees) === null || _chain$fees3 === void 0 ? void 0 : _chain$fees3.defaultPriorityFee;\n  try {\n    const maxPriorityFeePerGasHex = await client.request({\n      method: 'eth_maxPriorityFeePerGas'\n    });\n    return hexToBigInt(maxPriorityFeePerGasHex);\n  } catch {\n    // If the RPC Provider does not support `eth_maxPriorityFeePerGas`\n    // fall back to calculating it manually via `gasPrice - baseFeePerGas`.\n    // See: https://github.com/ethereum/pm/issues/328#:~:text=eth_maxPriorityFeePerGas%20after%20London%20will%20effectively%20return%20eth_gasPrice%20%2D%20baseFee\n    const [block, gasPrice] = await Promise.all([block_ ? Promise.resolve(block_) : getAction(client, getBlock, 'getBlock')({}), getAction(client, getGasPrice, 'getGasPrice')({})]);\n    if (typeof block.baseFeePerGas !== 'bigint') throw new Eip1559FeesNotSupportedError();\n    const maxPriorityFeePerGas = gasPrice - block.baseFeePerGas;\n    if (maxPriorityFeePerGas < 0n) return 0n;\n    return maxPriorityFeePerGas;\n  }\n}","map":{"version":3,"names":["Eip1559FeesNotSupportedError","hexToBigInt","getAction","getBlock","getGasPrice","estimateMaxPriorityFeePerGas","client","args","internal_estimateMaxPriorityFeePerGas","_chain$fees","_chain$fees2","_chain$fees3","block","block_","chain","request","fees","defaultPriorityFee","maxPriorityFeePerGasHex","method","gasPrice","Promise","all","resolve","baseFeePerGas","maxPriorityFeePerGas"],"sources":["C:\\Users\\takap\\OneDrive - Chiba Institute of Technology\\デスクトップ\\web3-sotuken\\node_modules\\viem\\actions\\public\\estimateMaxPriorityFeePerGas.ts"],"sourcesContent":["import type { Client } from '../../clients/createClient.js'\nimport type { Transport } from '../../clients/transports/createTransport.js'\nimport {\n  Eip1559FeesNotSupportedError,\n  type Eip1559FeesNotSupportedErrorType,\n} from '../../errors/fee.js'\nimport type { ErrorType } from '../../errors/utils.js'\nimport type { Account } from '../../types/account.js'\nimport type { Block } from '../../types/block.js'\nimport type { Chain, ChainFeesFnParameters } from '../../types/chain.js'\nimport type { GetChain } from '../../types/chain.js'\nimport type { RequestErrorType } from '../../utils/buildRequest.js'\nimport {\n  type HexToBigIntErrorType,\n  hexToBigInt,\n} from '../../utils/encoding/fromHex.js'\nimport { getAction } from '../../utils/getAction.js'\nimport type { PrepareTransactionRequestParameters } from '../wallet/prepareTransactionRequest.js'\nimport { type GetBlockErrorType, getBlock } from './getBlock.js'\nimport { type GetGasPriceErrorType, getGasPrice } from './getGasPrice.js'\n\nexport type EstimateMaxPriorityFeePerGasParameters<\n  chain extends Chain | undefined = Chain | undefined,\n  chainOverride extends Chain | undefined = Chain | undefined,\n> = GetChain<chain, chainOverride>\n\nexport type EstimateMaxPriorityFeePerGasReturnType = bigint\n\nexport type EstimateMaxPriorityFeePerGasErrorType =\n  | GetBlockErrorType\n  | HexToBigIntErrorType\n  | RequestErrorType\n  | GetBlockErrorType\n  | GetGasPriceErrorType\n  | Eip1559FeesNotSupportedErrorType\n  | ErrorType\n\n/**\n * Returns an estimate for the max priority fee per gas (in wei) for a\n * transaction to be likely included in the next block.\n * Defaults to [`chain.fees.defaultPriorityFee`](/docs/clients/chains.html#fees-defaultpriorityfee) if set.\n *\n * - Docs: https://viem.sh/docs/actions/public/estimateMaxPriorityFeePerGas.html\n *\n * @param client - Client to use\n * @returns An estimate (in wei) for the max priority fee per gas. {@link EstimateMaxPriorityFeePerGasReturnType}\n *\n * @example\n * import { createPublicClient, http } from 'viem'\n * import { mainnet } from 'viem/chains'\n * import { estimateMaxPriorityFeePerGas } from 'viem/actions'\n *\n * const client = createPublicClient({\n *   chain: mainnet,\n *   transport: http(),\n * })\n * const maxPriorityFeePerGas = await estimateMaxPriorityFeePerGas(client)\n * // 10000000n\n */\nexport async function estimateMaxPriorityFeePerGas<\n  chain extends Chain | undefined,\n  chainOverride extends Chain | undefined,\n>(\n  client: Client<Transport, chain>,\n  args?: EstimateMaxPriorityFeePerGasParameters<chain, chainOverride>,\n): Promise<EstimateMaxPriorityFeePerGasReturnType> {\n  return internal_estimateMaxPriorityFeePerGas(client, args as any)\n}\n\nexport async function internal_estimateMaxPriorityFeePerGas<\n  chain extends Chain | undefined,\n  chainOverride extends Chain | undefined,\n>(\n  client: Client<Transport, chain>,\n  args: EstimateMaxPriorityFeePerGasParameters<chain, chainOverride> & {\n    block?: Block\n    request?: PrepareTransactionRequestParameters<\n      chain,\n      Account | undefined,\n      chainOverride\n    >\n  },\n): Promise<EstimateMaxPriorityFeePerGasReturnType> {\n  const { block: block_, chain = client.chain, request } = args || {}\n  if (typeof chain?.fees?.defaultPriorityFee === 'function') {\n    const block = block_ || (await getAction(client, getBlock, 'getBlock')({}))\n    return chain.fees.defaultPriorityFee({\n      block,\n      client,\n      request,\n    } as ChainFeesFnParameters)\n  }\n\n  if (typeof chain?.fees?.defaultPriorityFee !== 'undefined')\n    return chain?.fees?.defaultPriorityFee\n\n  try {\n    const maxPriorityFeePerGasHex = await client.request({\n      method: 'eth_maxPriorityFeePerGas',\n    })\n    return hexToBigInt(maxPriorityFeePerGasHex)\n  } catch {\n    // If the RPC Provider does not support `eth_maxPriorityFeePerGas`\n    // fall back to calculating it manually via `gasPrice - baseFeePerGas`.\n    // See: https://github.com/ethereum/pm/issues/328#:~:text=eth_maxPriorityFeePerGas%20after%20London%20will%20effectively%20return%20eth_gasPrice%20%2D%20baseFee\n    const [block, gasPrice] = await Promise.all([\n      block_\n        ? Promise.resolve(block_)\n        : getAction(client, getBlock, 'getBlock')({}),\n      getAction(client, getGasPrice, 'getGasPrice')({}),\n    ])\n\n    if (typeof block.baseFeePerGas !== 'bigint')\n      throw new Eip1559FeesNotSupportedError()\n\n    const maxPriorityFeePerGas = gasPrice - block.baseFeePerGas\n\n    if (maxPriorityFeePerGas < 0n) return 0n\n    return maxPriorityFeePerGas\n  }\n}\n"],"mappings":"AAEA,SACEA,4BAA4B,QAEvB,qBAAqB;AAO5B,SAEEC,WAAW,QACN,iCAAiC;AACxC,SAASC,SAAS,QAAQ,0BAA0B;AAEpD,SAAiCC,QAAQ,QAAQ,eAAe;AAChE,SAAoCC,WAAW,QAAQ,kBAAkB;AAkBzE;;;;;;;;;;;;;;;;;;;;;;AAsBA,OAAO,eAAeC,4BAA4BA,CAIhDC,MAAgC,EAChCC,IAAmE;EAEnE,OAAOC,qCAAqC,CAACF,MAAM,EAAEC,IAAW,CAAC;AACnE;AAEA,OAAO,eAAeC,qCAAqCA,CAIzDF,MAAgC,EAChCC,IAOC;EAAA,IAAAE,WAAA,EAAAC,YAAA,EAAAC,YAAA;EAED,MAAM;IAAEC,KAAK,EAAEC,MAAM;IAAEC,KAAK,GAAGR,MAAM,CAACQ,KAAK;IAAEC;EAAO,CAAE,GAAGR,IAAI,IAAI,EAAE;EACnE,IAAI,QAAOO,KAAK,aAALA,KAAK,gBAAAL,WAAA,GAALK,KAAK,CAAEE,IAAI,cAAAP,WAAA,uBAAXA,WAAA,CAAaQ,kBAAkB,MAAK,UAAU,EAAE;IACzD,MAAML,KAAK,GAAGC,MAAM,KAAK,MAAMX,SAAS,CAACI,MAAM,EAAEH,QAAQ,EAAE,UAAU,CAAC,CAAC,EAAE,CAAC,CAAC;IAC3E,OAAOW,KAAK,CAACE,IAAI,CAACC,kBAAkB,CAAC;MACnCL,KAAK;MACLN,MAAM;MACNS;KACwB,CAAC;;EAG7B,IAAI,QAAOD,KAAK,aAALA,KAAK,gBAAAJ,YAAA,GAALI,KAAK,CAAEE,IAAI,cAAAN,YAAA,uBAAXA,YAAA,CAAaO,kBAAkB,MAAK,WAAW,EACxD,OAAOH,KAAK,aAALA,KAAK,gBAAAH,YAAA,GAALG,KAAK,CAAEE,IAAI,cAAAL,YAAA,uBAAXA,YAAA,CAAaM,kBAAkB;EAExC,IAAI;IACF,MAAMC,uBAAuB,GAAG,MAAMZ,MAAM,CAACS,OAAO,CAAC;MACnDI,MAAM,EAAE;KACT,CAAC;IACF,OAAOlB,WAAW,CAACiB,uBAAuB,CAAC;GAC5C,CAAC,MAAM;IACN;IACA;IACA;IACA,MAAM,CAACN,KAAK,EAAEQ,QAAQ,CAAC,GAAG,MAAMC,OAAO,CAACC,GAAG,CAAC,CAC1CT,MAAM,GACFQ,OAAO,CAACE,OAAO,CAACV,MAAM,CAAC,GACvBX,SAAS,CAACI,MAAM,EAAEH,QAAQ,EAAE,UAAU,CAAC,CAAC,EAAE,CAAC,EAC/CD,SAAS,CAACI,MAAM,EAAEF,WAAW,EAAE,aAAa,CAAC,CAAC,EAAE,CAAC,CAClD,CAAC;IAEF,IAAI,OAAOQ,KAAK,CAACY,aAAa,KAAK,QAAQ,EACzC,MAAM,IAAIxB,4BAA4B,EAAE;IAE1C,MAAMyB,oBAAoB,GAAGL,QAAQ,GAAGR,KAAK,CAACY,aAAa;IAE3D,IAAIC,oBAAoB,GAAG,EAAE,EAAE,OAAO,EAAE;IACxC,OAAOA,oBAAoB;;AAE/B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}